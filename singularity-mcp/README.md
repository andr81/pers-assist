# SingularityApp MCP Server

MCP-сервер для интеграции планировщика [SingularityApp](https://singularity-app.ru/) с Claude Code.

## Возможности

- **Задачи**: создание, просмотр, обновление, завершение, удаление
- **Проекты**: создание, просмотр, удаление
- **Привычки**: создание, просмотр, отметка выполнения
- **Теги**: создание, просмотр
- **Чек-листы**: добавление пунктов к задачам

## Требования

- Python 3.10+
- Подписка SingularityApp **Pro** или **Elite** (для доступа к API)
- API-токен из [личного кабинета](https://me.singularity-app.com)

## Установка

### 1. Клонируйте или скопируйте проект

```bash
git clone <repository-url>
cd singularity-mcp
```

### 2. Установите зависимости

```bash
pip install -e .
```

Или с использованием uv:

```bash
uv pip install -e .
```

### 3. Получите API-токен

1. Перейдите в [личный кабинет SingularityApp](https://me.singularity-app.com)
2. Откройте раздел «Доступ к API»
3. Нажмите «Создать токен»
4. Выберите нужные права (задачи, проекты, привычки и т.д.)
5. Скопируйте токен

### 4. Настройте Claude Code

Добавьте конфигурацию в файл `~/.claude/claude_desktop_config.json`:

```json
{
  "mcpServers": {
    "singularity": {
      "command": "singularity-mcp",
      "env": {
        "SINGULARITY_API_TOKEN": "ваш-токен-здесь"
      }
    }
  }
}
```

Или, если используете путь к Python:

```json
{
  "mcpServers": {
    "singularity": {
      "command": "python",
      "args": ["-m", "singularity_mcp.server"],
      "env": {
        "SINGULARITY_API_TOKEN": "ваш-токен-здесь"
      }
    }
  }
}
```

### 5. Перезапустите Claude Code

После перезапуска вы сможете использовать команды для работы с SingularityApp.

## Доступные инструменты

### Задачи

| Инструмент | Описание |
|------------|----------|
| `list_tasks` | Получить список задач |
| `get_task` | Получить задачу по ID |
| `create_task` | Создать новую задачу |
| `update_task` | Обновить задачу |
| `complete_task` | Отметить задачу выполненной |
| `delete_task` | Удалить задачу |
| `get_today_tasks` | Получить задачи на сегодня |

### Проекты

| Инструмент | Описание |
|------------|----------|
| `list_projects` | Получить список проектов |
| `create_project` | Создать новый проект |
| `delete_project` | Удалить проект |

### Привычки

| Инструмент | Описание |
|------------|----------|
| `list_habits` | Получить список привычек |
| `create_habit` | Создать новую привычку |
| `mark_habit` | Отметить привычку выполненной |

### Теги

| Инструмент | Описание |
|------------|----------|
| `list_tags` | Получить список тегов |
| `create_tag` | Создать новый тег |

### Чек-листы

| Инструмент | Описание |
|------------|----------|
| `add_checklist_item` | Добавить пункт в чек-лист задачи |

## Официальная документация API

### Основная информация

- **Базовый URL**: `https://api.singularity-app.com/v2/`
- **Документация**: https://singularity-app.ru/wiki/api/
- **Swagger/OpenAPI**: https://api.singularity-app.com/v2/api
- **Аутентификация**: Bearer Token (создается в личном кабинете)

### Основные эндпоинты API v2

#### Задачи (Tasks)
- **GET** `/v2/task` - Получить список задач
  - Параметры фильтрации:
    - `includeRemoved` (boolean) - включить удаленные задачи
    - `includeArchived` (boolean) - включить архивированные задачи
    - `maxCount` (number) - максимальное количество результатов
    - `projectId` (string) - фильтр по проекту
    - `parent` (string) - получить подзадачи конкретной задачи
    - `startDateFrom`, `startDateTo` (ISO date) - фильтр по датам
- **GET** `/v2/task/{id}` - Получить конкретную задачу
- **POST** `/v2/task` - Создать задачу
- **PATCH** `/v2/task/{id}` - Обновить задачу
- **DELETE** `/v2/task/{id}` - Удалить задачу

#### Проекты (Projects)
- **GET** `/v2/project` - Получить список проектов
- **GET** `/v2/project/{id}` - Получить конкретный проект
- **POST** `/v2/project` - Создать проект
- **PATCH** `/v2/project/{id}` - Обновить проект
- **DELETE** `/v2/project/{id}` - Удалить проект

#### Привычки (Habits)
- **GET** `/v2/habit` - Получить список привычек
- **GET** `/v2/habit/{id}` - Получить конкретную привычку
- **POST** `/v2/habit` - Создать привычку
  - Обязательные поля:
    - `description` (string) - описание привычки
    - `color` (string) - цвет привычки (red, pink, purple, green, и т.д.)
- **PATCH** `/v2/habit/{id}` - Обновить привычку
- **DELETE** `/v2/habit/{id}` - Удалить привычку

#### Отметка привычки
- **POST** `/v2/habit/mark` - Отметить привычку выполненной
  - Параметры:
    - `habit` (string) - ID привычки (например, "HB-123")
    - `date` (string) - дата в формате YYYY-MM-DD
    - `progress` (number):
      - `0` - стандартное значение
      - `1` - НЕ выполнено (сохраняет серию)
      - `2` - выполнено полностью

#### Теги (Tags)
- **GET** `/v2/tag` - Получить список тегов
- **POST** `/v2/tag` - Создать тег
- **PATCH** `/v2/tag/{id}` - Обновить тег
- **DELETE** `/v2/tag/{id}` - Удалить тег

### Заголовки запросов

Все запросы должны содержать:
```
Authorization: Bearer YOUR_API_TOKEN
Content-Type: application/json
```

### Примеры cURL запросов

#### Получить задачи на сегодня
```bash
curl -X GET "https://api.singularity-app.com/v2/task?startDateFrom=2024-12-08T00:00:00&startDateTo=2024-12-08T23:59:59" \
  -H "Authorization: Bearer YOUR_API_TOKEN" \
  -H "Content-Type: application/json"
```

#### Создать новую задачу
```bash
curl -X POST "https://api.singularity-app.com/v2/task" \
  -H "Authorization: Bearer YOUR_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Купить продукты",
    "note": "Молоко, хлеб, яйца",
    "start": "2024-12-09T00:00:00",
    "priority": 0
  }'
```

#### Создать привычку
```bash
curl -X POST "https://api.singularity-app.com/v2/habit" \
  -H "Authorization: Bearer YOUR_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Пить воду",
    "description": "8 стаканов в день",
    "color": "lightBlue"
  }'
```

#### Отметить привычку выполненной
```bash
curl -X POST "https://api.singularity-app.com/v2/habit/mark" \
  -H "Authorization: Bearer YOUR_API_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "habit": "HB-123",
    "date": "2024-12-08T00:00:00",
    "progress": 2
  }'
```

### Важные ограничения API

- Не поддерживается создание повторяющихся задач через API
- Отсутствуют вебхуки и подписки на изменения
- Совместные проекты не возвращаются через API
- Техподдержка не оказывает помощь по кастомным интеграциям

## Примеры использования в Claude Code

```
> Покажи мои задачи на сегодня

> Создай задачу "Купить продукты" на завтра с высоким приоритетом

> Покажи все проекты

> Создай привычку "Пить воду" зелёного цвета

> Отметь привычку HB-123 выполненной
```

## Формат дат и часовые пояса

### Автоматическое определение часового пояса

MCP-сервер автоматически определяет часовой пояс из системных настроек вашего компьютера и корректно конвертирует время между локальным временем и UTC.

**Как это работает:**
- API SingularityApp хранит все даты в UTC
- При запросе задач "на сегодня" сервер использует ваш системный часовой пояс
- Все конвертации происходят автоматически

**Пример:** Если вы находитесь в Москве (UTC+3):
- Задача на 10:00 по московскому времени сохраняется как 07:00 UTC
- При запросе задач "на сегодня" берется диапазон с 21:00 предыдущего дня до 21:00 текущего дня по UTC

### Формат дат в API

API SingularityApp требует даты в полном формате ISO 8601 с указанием времени:
- **Правильно**: `2024-01-01T00:00:00` или `2024-01-01T23:59:59`
- **Неправильно**: `2024-01-01` (только дата без времени)

Для фильтрации задач по датам используйте:
- `startDateFrom`: начало дня, например `2024-12-08T00:00:00`
- `startDateTo`: конец дня, например `2024-12-08T23:59:59`

MCP сервер автоматически добавляет время к датам при необходимости.

## Ограничения API

- API не поддерживает создание повторяющихся задач
- Нет поддержки вебхуков и подписок на изменения
- Совместные проекты не возвращаются через API

## Лицензия

MIT
